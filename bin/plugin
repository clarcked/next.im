#!/bin/bash

PLUGIN_ROOT_DIR="./app/plugins"
SAMPLE_DIR="./bin/samples/plugin"


create_sample(){

    file=$1 
    cp "$SAMPLE_DIR/$file.txt" "$PLUGIN_DIR/$file"    
    
    sed -i "s/entity/$entity/g" "$PLUGIN_DIR/$file"
    sed -i "s/Entity/$Entity/g" "$PLUGIN_DIR/$file"
    sed -i "s/ENTITY/$ENTITY/g" "$PLUGIN_DIR/$file"
    sed -i "s/entities/$entities/g" "$PLUGIN_DIR/$file"
    sed -i "s/Entities/$Entities/g" "$PLUGIN_DIR/$file"
    sed -i "s/ENTITIES/$ENTITIES/g" "$PLUGIN_DIR/$file"

    echo "file created: $PLUGIN_DIR/$file"
}

create_plugin(){
    continue="y"
    while [[ "$continue" == "y" ]];do

        if [ ! -d "$PLUGIN_ROOT_DIR" ]; then
            mkdir "$PLUGIN_ROOT_DIR"
        fi

        echo "Enter plugin name"
        read name
        echo "Enter plural form"
        read plural  

        entity=${name,,}
        entities=${plural,,}
        Entity=${entity^}
        ENTITY=${entity^^}
        Entities=${entities^}
        ENTITIES=${entities^^}

        PLUGIN_DIR="$PLUGIN_ROOT_DIR/$entity" 
        
        if [ ! -d "$PLUGIN_DIR" ]; then
            mkdir "$PLUGIN_DIR"
        fi

        create_sample "queries.ts" 
        # create_sample "manager.tsx"  
        # create_sample "link.tsx" 
        # create_sample "model.ts"  
        # create_sample "index.ts" 

        echo "continue ?: y/N"
        read continue
    done
}

create_plugin